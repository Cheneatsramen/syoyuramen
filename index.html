<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Pac-Man Game</title>
<style>
  canvas { background:black; display:block; margin:0 auto; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const rawMap = [
"##########",
"#........#",
"#.####.#.#",
"#........#",
"#.##.##..#",
"#........#",
"#.######.#",
"#........#",
"#........#",
"##########"
];
const map = rawMap.map(r => r.split(''));
const rows = map.length;
const cols = map[0].length;
const tile = 32;
const canvas = document.getElementById('game');
canvas.width = cols * tile;
canvas.height = rows * tile;
const ctx = canvas.getContext('2d');
let pac = {x:1,y:1,dx:0,dy:0};
let ghost = {x:cols-2,y:rows-2,dx:0,dy:0};
let score = 0;
let maxScore = 0;
let gameOver = false;
for(let r=0;r<rows;r++){
  for(let c=0;c<cols;c++){
    if(map[r][c] === '.') maxScore++;
  }
}
function drawMap(){
  for(let y=0;y<rows;y++){
    for(let x=0;x<cols;x++){
      const ch = map[y][x];
      if(ch === '#'){
        ctx.fillStyle = 'blue';
        ctx.fillRect(x*tile,y*tile,tile,tile);
      }else if(ch === '.'){
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(x*tile+tile/2,y*tile+tile/2,4,0,Math.PI*2);
        ctx.fill();
      }
    }
  }
}
function drawPac(){
  ctx.fillStyle = 'yellow';
  ctx.beginPath();
  ctx.arc(pac.x*tile+tile/2,pac.y*tile+tile/2,tile/2-2,0.25*Math.PI,1.75*Math.PI);
  ctx.lineTo(pac.x*tile+tile/2,pac.y*tile+tile/2);
  ctx.fill();
}
function drawGhost(){
  ctx.fillStyle = 'red';
  ctx.beginPath();
  ctx.arc(ghost.x*tile+tile/2,ghost.y*tile+tile/2,tile/2-2,0,Math.PI*2);
  ctx.fill();
}
function movePac(){
  const nx = pac.x + pac.dx;
  const ny = pac.y + pac.dy;
  if(map[ny][nx] !== '#'){
    pac.x = nx; pac.y = ny;
    if(map[ny][nx] === '.'){
      map[ny][nx] = ' ';
      score++;
    }
  }
}
function moveGhost(){
  if(Math.random()<0.25){
    const dirs = [{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];
    const d = dirs[Math.floor(Math.random()*4)];
    if(map[ghost.y+d.y][ghost.x+d.x] !== '#'){
      ghost.dx = d.x; ghost.dy = d.y;
    }
  }
  const nx = ghost.x + ghost.dx;
  const ny = ghost.y + ghost.dy;
  if(map[ny][nx] !== '#'){
    ghost.x = nx; ghost.y = ny;
  } else {
    ghost.dx = 0; ghost.dy = 0;
  }
}
function update(){
  if(gameOver) return;
  movePac();
  moveGhost();
  if(pac.x === ghost.x && pac.y === ghost.y){
    gameOver = true;
  }
  if(score === maxScore){
    gameOver = true;
  }
}
function render(){
  ctx.fillStyle='black';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  drawMap();
  drawPac();
  drawGhost();
  ctx.fillStyle='white';
  ctx.font='16px sans-serif';
  ctx.fillText('Score: '+score,5,canvas.height-5);
  if(gameOver){
    ctx.fillStyle='white';
    ctx.font='24px sans-serif';
    const text = score===maxScore ? 'You Win!' : 'Game Over';
    ctx.fillText(text, canvas.width/2-60, canvas.height/2);
  }
}
function tick(){
  update();
  render();
}
setInterval(tick,200);
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowUp'){pac.dx=0;pac.dy=-1;}
  else if(e.key==='ArrowDown'){pac.dx=0;pac.dy=1;}
  else if(e.key==='ArrowLeft'){pac.dx=-1;pac.dy=0;}
  else if(e.key==='ArrowRight'){pac.dx=1;pac.dy=0;}
});
</script>
</body>
</html>
